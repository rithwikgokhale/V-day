<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Decode V-Day Code</title>
    <style>
      :root {
        font-family: 'Avenir Next', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        color: #2f2330;
        background: #fff8fb;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 16px;
      }

      main {
        width: min(760px, 100%);
        background: #fff;
        border: 1px solid #f0cfdd;
        border-radius: 16px;
        box-shadow: 0 10px 28px rgba(153, 94, 125, 0.14);
        padding: 18px;
      }

      h1 {
        margin: 0 0 8px;
        font-size: 1.55rem;
      }

      p {
        margin: 0 0 12px;
        color: #6d5664;
      }

      input,
      button,
      textarea {
        font: inherit;
      }

      input,
      textarea {
        width: 100%;
        border: 1px solid #e6c5d5;
        border-radius: 10px;
        padding: 10px;
        box-sizing: border-box;
      }

      textarea {
        min-height: 190px;
        resize: vertical;
      }

      .row {
        display: flex;
        gap: 8px;
        margin: 10px 0;
        flex-wrap: wrap;
      }

      button {
        border: 1px solid transparent;
        border-radius: 10px;
        background: #e74c8a;
        color: #fff;
        font-weight: 700;
        padding: 9px 14px;
        cursor: pointer;
      }

      button.secondary {
        background: #fff;
        color: #2f2330;
        border-color: #e6c5d5;
      }

      .hidden {
        display: none;
      }

      .error {
        color: #a22e4f;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Decode V-Day Code</h1>
      <p>Enter your passcode, then paste the CODE from email.</p>

      <input id="passcode" type="password" placeholder="Passcode" />
      <div class="row">
        <button id="unlock">Unlock</button>
      </div>

      <div id="decoder" class="hidden">
        <textarea id="codeInput" placeholder="Paste V1-..."></textarea>
        <div class="row">
          <button id="decodeBtn">Decode</button>
          <button id="clearBtn" class="secondary">Clear</button>
        </div>
        <p id="status"></p>
        <textarea id="result" readonly placeholder="Decoded JSON appears here"></textarea>
      </div>
    </main>

    <script>
      const PASSCODE = 'ana'

      const decoder = document.getElementById('decoder')
      const unlock = document.getElementById('unlock')
      const passcodeInput = document.getElementById('passcode')
      const codeInput = document.getElementById('codeInput')
      const decodeBtn = document.getElementById('decodeBtn')
      const clearBtn = document.getElementById('clearBtn')
      const result = document.getElementById('result')
      const status = document.getElementById('status')

      function fromBase64Url(input) {
        const base64 = input.replace(/-/g, '+').replace(/_/g, '/')
        const padded = base64 + '='.repeat((4 - (base64.length % 4)) % 4)
        return decodeURIComponent(escape(window.atob(padded)))
      }

      function decodeCode(code) {
        if (!code.startsWith('V1-')) {
          throw new Error('Code should start with V1-')
        }
        const json = fromBase64Url(code.slice(3))
        return JSON.parse(json)
      }

      unlock.addEventListener('click', () => {
        if (passcodeInput.value !== PASSCODE) {
          status.textContent = 'Wrong passcode.'
          status.className = 'error'
          return
        }
        status.textContent = 'Unlocked.'
        status.className = ''
        decoder.classList.remove('hidden')
      })

      decodeBtn.addEventListener('click', () => {
        try {
          const payload = decodeCode(codeInput.value.trim())
          result.value = JSON.stringify(payload, null, 2)
          status.textContent = 'Decoded successfully.'
          status.className = ''
        } catch (error) {
          status.textContent = `Decode failed: ${error.message}`
          status.className = 'error'
        }
      })

      clearBtn.addEventListener('click', () => {
        codeInput.value = ''
        result.value = ''
        status.textContent = ''
        status.className = ''
      })
    </script>
  </body>
</html>
